# Omada WPA2-Enterprise (802.1X) Setup

This platform is designed for **WPA2-Enterprise roaming** across multiple APs/sites with **FreeRADIUS as the single authority**.

## RADIUS server settings

In Omada Controller:

- RADIUS Auth Server:
  - IP: `<your server IP>`
  - Port: `1812`
  - Shared Secret: the `RADIUS_SHARED_SECRET` printed by the installer
- RADIUS Accounting Server:
  - IP: `<your server IP>`
  - Port: `1813`
  - Shared Secret: same as above

## Interim-Update accounting (required)

Enable RADIUS accounting and set Interim-Update interval:

- Recommended: 60 seconds

Wallet time-based plans are decremented on Interim-Update and Stop events.

## EAP method

The included FreeRADIUS config supports:

- EAP-TTLS (inner method: PAP) - recommended for lab validation
- PEAP (inner method: MSCHAPv2) - enabled; requires clients to support it

Username: user phone number in E.164 (e.g. `+15551234567`)

Password: the WiFi password generated by the platform (delivered via SMS provider; default is MockSMS which logs to DB).

## Roaming behavior

Roaming across APs is allowed **only for the same device** (same `Calling-Station-Id` / MAC).
If a different device attempts to authenticate while a session is active, it is rejected.

## Top-Up Portal (Recommended)

End-user portal URL:

- `http(s)://<server>/portal`

Because WPA2-Enterprise rejects users with no credit (no network access), the recommended setup is to create a
separate SSID for top-ups:

1. Create SSID `CentralWiFi-TopUp` (Open or WPA2-PSK).
2. Enable Omada Portal for that SSID.
3. Set external portal URL to `http(s)://<server>/portal`.
4. Configure Omada walled garden so clients can reach `<server>` while in the portal network.

After top-up, users connect to the WPA2-Enterprise SSID using:

- Username: E.164 phone (e.g. `+639171234567`)
- Password: SMS password

## Advanced: Walled Garden VLAN on No Credit

If your Omada/AP supports VLAN assignment via RADIUS:

- Admin UI -> Setup Wizard -> **Top-Up Portal** -> enable **Walled Garden mode** and set VLAN ID

Then create a restricted VLAN/network policy that only allows access to the portal and required API endpoints.
