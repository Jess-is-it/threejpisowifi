{
  # Keep logs simple and container-friendly.
}

{$CW_DOMAIN} {
  encode zstd gzip

  @health path /healthz
  respond @health 200

  @ops path /api/v1/ops/*
  reverse_proxy @ops ops:9000

  @api path /api/* /openapi.json /docs /docs/*
  reverse_proxy @api api:8000

  # End-user top-up portal (served behind /portal).
  handle_path /portal* {
    reverse_proxy portal:80
  }

  reverse_proxy admin:80

  header {
    X-Frame-Options "DENY"
    X-Content-Type-Options "nosniff"
    Referrer-Policy "no-referrer"
    Permissions-Policy "geolocation=(), microphone=(), camera=()"
  }
}
